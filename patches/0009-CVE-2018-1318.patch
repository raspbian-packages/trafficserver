Description: Patch for CVE-2018-1318
 Adding method ACLs in remap.config can cause a segfault when the user makes a
 carefully crafted request. 
Author: Leif Hedstrom <zwoop@apache.org>
Origin: upstream, https://github.com/apache/trafficserver/pull/3195
Applied-Upstream: https://github.com/apache/trafficserver/commit/e6dfda305acf85250861ecfa14a7bd6bb2fad5c3
Reviewed-by: Jean Baptiste Favre <debian@jbfavre.org>
Last-Update: 2018-08-29
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/proxy/http/remap/UrlRewrite.cc
+++ b/proxy/http/remap/UrlRewrite.cc
@@ -404,7 +404,7 @@ UrlRewrite::PerformACLFiltering(HttpTran
       bool match = true;
 
       if (rp->method_restriction_enabled) {
-        if (method_wksidx != -1) {
+        if (method_wksidx >= 0 && method_wksidx < HTTP_WKSIDX_METHODS_CNT) {
           match = rp->standard_method_lookup[method_wksidx];
         } else if (!rp->nonstandard_methods.empty()) {
           match = false;
